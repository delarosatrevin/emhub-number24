import random

DATA = {1: [["1", "2", "3", "4"], ["8", "8", "7", "3"], ["1", "9", "5", "5"], ["1", "1", "4", "4"],
        ["1", "1", "5", "6"], ["3", "3", "5", "6"], ["8", "8", "4", "9"], ["2", "2", "4", "6"], ["3", "9", "9", "7"],
        ["2", "2", "8", "6"], ["9", "3", "6", "6"], ["2", "3", "5", "9"], ["1", "4", "8", "8"], ["1", "5", "8", "8"],
        ["6", "3", "6", "6"], ["4", "8", "5", "7"], ["3", "3", "4", "8"], ["1", "1", "4", "8"], ["3", "7", "7", "7"],
        ["1", "2", "6", "6"], ["3", "4", "5", "5"], ["3", "8", "8", "8"], ["3", "4", "6", "8"], ["4", "4", "8", "8"],
        ["3", "9", "9", "9"], ["1", "1", "2", "9"], ["2", "4", "8", "8"], ["1", "2", "4", "4"], ["1", "5", "7", "8"],
        ["5", "5", "7", "7"], ["1", "8", "7", "9"], ["6", "6", "6", "6"], ["1", "2", "5", "9"], ["4", "4", "5", "8"],
        ["2", "3", "3", "6"], ["4", "6", "7", "7"], ["1", "6", "8", "9"], ["1", "2", "5", "8"], ["1", "7", "8", "8"],
        ["1", "2", "6", "8"], ["5", "6", "6", "7"], ["2", "4", "4", "8"], ["1", "4", "5", "5"], ["4", "6", "6", "8"],
        ["3", "4", "5", "7"], ["1", "3", "3", "4"], ["1", "1", "4", "7"], ["1", "2", "2", "7"]],
        2: [["3", "5", "6", "7"], ["1", "4", "9", "7"], ["4", "7", "8", "8"], ["2", "4", "6", "6"], ["1", "2", "9", "6"],
        ["5", "6", "7", "8"], ["1", "5", "7", "9"], ["1", "3", "5", "9"], ["1", "5", "6", "8"], ["1", "2", "4", "9"],
        ["2", "2", "2", "5"], ["1", "3", "9", "3"], ["2", "3", "4", "6"], ["4", "5", "7", "7"], ["3", "3", "3", "9"],
        ["1", "2", "8", "8"], ["4", "4", "5", "6"], ["1", "6", "7", "9"], ["1", "1", "6", "9"], ["2", "4", "4", "4"],
        ["3", "3", "4", "5"], ["2", "3", "4", "4"], ["1", "4", "4", "9"], ["5", "6", "6", "8"], ["3", "5", "5", "7"],
        ["4", "4", "4", "9"], ["2", "3", "3", "8"], ["2", "2", "4", "7"], ["6", "8", "8", "8"], ["4", "5", "8", "9"],
        ["2", "7", "3", "6"], ["2", "2", "6", "7"], ["1", "3", "5", "6"], ["2", "4", "6", "7"], ["1", "3", "6", "8"],
        ["1", "3", "5", "8"], ["4", "4", "4", "5"], ["2", "3", "5", "6"], ["2", "6", "7", "9"], ["3", "4", "8", "9"],
        ["2", "2", "3", "6"], ["1", "3", "6", "6"], ["3", "4", "9", "9"], ["4", "5", "6", "9"], ["3", "4", "5", "9"],
        ["2", "5", "6", "8"], ["2", "2", "4", "8"], ["7", "8", "8", "9"]],
        3: [["2", "3", "7", "9"], ["2", "2", "5", "7"], ["2", "4", "7", "9"], ["2", "3", "6", "8"], ["1", "2", "2", "8"],
        ["4", "4", "8", "5"], ["2", "6", "8", "9"], ["3", "5", "9", "9"], ["1", "4", "6", "9"], ["5", "8", "8", "8"],
        ["2", "2", "2", "7"], ["1", "4", "5", "8"], ["2", "5", "6", "9"], ["6", "7", "9", "9"], ["3", "4", "7", "7"],
        ["2", "2", "5", "9"], ["3", "3", "5", "7"], ["3", "3", "3", "5"], ["2", "5", "5", "8"], ["4", "8", "9", "9"],
        ["2", "2", "6", "9"], ["1", "3", "8", "8"], ["5", "8", "8", "9"], ["3", "3", "6", "8"], ["2", "5", "7", "9"],
        ["2", "3", "8", "9"], ["5", "6", "6", "9"], ["5", "7", "8", "9"], ["2", "7", "8", "9"], ["4", "4", "8", "9"],
        ["1", "3", "4", "8"], ["4", "5", "9", "9"], ["1", "4", "6", "7"], ["2", "2", "3", "5"], ["1", "4", "6", "8"],
        ["1", "2", "4", "5"], ["3", "5", "7", "9"], ["3", "4", "4", "9"], ["4", "5", "5", "7"], ["5", "7", "8", "8"],
        ["1", "4", "6", "6"], ["2", "4", "5", "5"], ["3", "5", "8", "9"], ["2", "3", "5", "7"], ["2", "3", "8", "6"],
        ["4", "7", "7", "7"], ["3", "4", "4", "4"], ["3", "3", "6", "6"]]};


def register_content(dc):

    @dc.content
    def dashboard(**kwargs):
        sequences = []
        for k, seqs in DATA.items():
            if k > 1:
                sequences.extend({'pts': k, 'seq': seq} for seq in seqs)

        random.seed()
        random.shuffle(sequences)

        data = {
            'sequences': sequences
        }
        return data


from collections import defaultdict
from itertools import permutations
import operator
import sys


def div(a, b):
    return -9999 if b < a or b == 0 or a % b else a / b


operators = {'+': operator.add, '-': operator.sub, '*': operator.mul, '/': div}

total = 0
unique = defaultdict(list)


def revrange(m):
    return reversed(range(1, 10))


def uniq(s):
    return ''.join(str(x) for x in sorted(s, reverse=True))


def join(s):
    return ''.join(str(x) for x in s)


def solve_1x1(a, b):
    for label, op in operators.items():
        if op(a, b) == 24:
            return label
    return None


def solve_2x2(s):
    solutions = []
    for label1, op1 in operators.items():
        for label2, op2 in operators.items():
            a = op1(s[0], s[1])
            b = op2(s[2], s[3])
            op = solve_1x1(a, b)
            if op and a > 0 and b > 0:
                solutions.append(f"({s[0]} {label1} {s[1]}) {op} "
                                 f"({s[2]} {label2} {s[3]})")

            a = op1(s[0], s[1])
            b = op2(a, s[2])
            op = solve_1x1(b, s[3])
            if op and a > 0 and b > 0:
                sol = f"(({s[0]} {label1} {s[1]}) {label2} {s[2]}) {op} {s[3]}"
                solutions.append(sol)

            a = op1(s[1], s[2])
            b = op2(s[0], a)
            op = solve_1x1(b, s[3])
            if op and a > 0 and b > 0:
                sol = f"({s[0]} {label2} ({s[1]} {label1} {s[2]})) {op} {s[3]}"
                solutions.append(sol)

    return solutions


def solve(s, permute=False):
    if permute:
        alls = permutations(s)
    else:
        alls = [s]

    solutions = []
    for seq in alls:
        solutions.extend(solve_2x2(seq))
    return solutions


def printseq(s, permute=False):
    u = uniq(s)
    print(u, ":  ", s)
    solutions = solve(s, permute=permute)
    uniqSols = set()
    for sol in solutions:
        if sol not in uniqSols:
            print("   ", sol)
            uniqSols.add(sol)
    return len(solutions)

